local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local activated = false

local function PlayJumpscare()
	if activated then return end
	activated = true

	task.wait(2)

	-- GUI
	local gui = Instance.new("ScreenGui")
	gui.Name = "JumpscareOverlay"
	gui.IgnoreGuiInset = true
	gui.DisplayOrder = 999999
	gui.ResetOnSpawn = false
	gui.Parent = player:WaitForChild("PlayerGui")

	-- Jump scare image
	local img = Instance.new("ImageLabel")
	img.Size = UDim2.new(1, 0, 1, 0)
	img.BackgroundTransparency = 1
	img.BorderSizePixel = 0
	img.ImageTransparency = 0
	img.ScaleType = Enum.ScaleType.Stretch
	img.Parent = gui

	-- STATIC layer
	local static = Instance.new("ImageLabel")
	static.Size = UDim2.new(1, 0, 1, 0)
	static.BackgroundTransparency = 1
	static.BorderSizePixel = 0
	static.Image = "rbxassetid://11818626677"	-- static noise
	static.ImageTransparency = 0.7
	static.ScaleType = Enum.ScaleType.Tile
	static.TileSize = UDim2.new(3,0,3,0)       -- tile lớn cho hiệu ứng
	static.Parent = gui

	local jumpscareImage1 = "rbxassetid://94547864377343"
	local jumpscareImage2 = "rbxassetid://236542974"

	-- fade-in
	img.Image = jumpscareImage1
	TweenService:Create(img, TweenInfo.new(1.6), {ImageTransparency = 1}):Play()

	-- STATIC EFFECT LOOP
	local flashDuration = 1.6
	local start = tick()

	while tick() - start < flashDuration do

		-- Random nhiễu static
		static.ImageRectOffset = Vector2.new(math.random(0,600), math.random(0,600))
		static.ImageTransparency = math.random(3,7) / 10

		-- Run jump scare flash
		img.Image = jumpscareImage1
		task.wait()
		img.Image = jumpscareImage2
		task.wait()
	end
end

-- Chỉ khi máu <= 0
humanoid.HealthChanged:Connect(function(hp)
	if hp <= 0 then
		PlayJumpscare()
	end
end)
